%%{init: {
  'theme': 'base',
  'themeVariables': {
    'fontFamily': 'Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial',
    'primaryColor': '#0b1220',
    'primaryTextColor': '#e5e7eb',
    'primaryBorderColor': '#3b82f6',
    'lineColor': '#94a3b8',
    'secondaryColor': '#111827',
    'tertiaryColor': '#0ea5e9'
  },
  'sequence': {
    'actorBkg': '#0b1220',
    'actorBorder': '#3b82f6',
    'actorTextColor': '#e5e7eb',
    'actorLineColor': '#64748b',
    'signalColor': '#e5e7eb',
    'signalTextColor': '#e5e7eb',
    'labelBoxBkgColor': '#111827',
    'labelTextColor': '#e5e7eb',
    'labelBoxBorderColor': '#334155',
    'noteBkgColor': '#052e2b',
    'noteTextColor': '#d1fae5',
    'noteBorderColor': '#22c55e'
  }
}}}%%
sequenceDiagram
    participant PA as Primary Agent (01)
    participant DD as Data Dispatcher (02)
    participant CL as Cover Letter (05)
    participant DB as Persistent DB
    participant FS as File Storage

    PA->>DD: request generation
    DD->>CL: route_to_agent(cover_letter, {profile_id, job_posting_id, constraints})
    CL->>DB: fetch(profile_id)
    CL->>DB: fetch(job_posting_id)
    CL-->>DD: cover_letter + report
    DD->>DB: upsert(cover_letter)
    DB-->>DD: cover_letter_id
    DD->>FS: write_document(content)
    FS-->>DD: saved_path
    DD-->>PA: cover_letter_id + saved_path + report
    PA-->>PA: final formatting + checks
